<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YouTube Giveaway Picker â€” Pro Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
/* ---------- GLOBAL DARK THEME ---------- */
body {
    margin: 0;
    font-family: 'Inter', Arial, sans-serif;
    background: radial-gradient(circle at top, #1b1b1b, #000000);
    color: #fff;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    padding: 40px 20px;
}

/* ---------- MAIN CARD ---------- */
.container {
    width: 100%;
    max-width: 600px;
    background: rgba(255, 255, 255, 0.06);
    backdrop-filter: blur(18px);
    border-radius: 24px;
    padding: 35px;
    box-shadow: 0 0 50px rgba(0,0,0,0.5);
    animation: fadeIn 0.8s ease;
}

/* Fade in */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ---------- HEADER ---------- */
h1 {
    font-size: 32px;
    font-weight: 700;
    margin-bottom: 5px;
    text-align: center;
}

.subtitle {
    text-align: center;
    color: #bbb;
    font-size: 16px;
    margin-bottom: 30px;
}

/* ---------- INPUTS + BUTTONS ---------- */
input, button {
    width: 100%;
    padding: 14px;
    font-size: 17px;
    border-radius: 14px;
    border: none;
    outline: none;
    margin-top: 12px;
}

input {
    background: rgba(255,255,255,0.08);
    color: #fff;
    border: 1px solid rgba(255,255,255,0.15);
}

input::placeholder {
    color: #aaa;
}

button {
    background: linear-gradient(135deg, #007aff, #0051ff);
    color: white;
    font-weight: 600;
    cursor: pointer;
    transition: 0.2s ease;
}

button:hover {
    background: linear-gradient(135deg, #3395ff, #1a66ff);
    transform: scale(1.02);
    box-shadow: 0 0 15px rgba(0,122,255,0.4);
}

/* ---------- CHECKBOX ---------- */
.checkbox-row {
    margin-top: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 15px;
}

/* ---------- STATUS BOX ---------- */
#status {
    margin-top: 20px;
    padding: 18px;
    background: rgba(0,0,0,0.4);
    border-radius: 12px;
    text-align: center;
    font-size: 17px;
    min-height: 40px;
}

/* ---------- WINNER CARD ---------- */
#winnerBox {
    margin-top: 25px;
    display: none;
    padding: 25px;
    background: rgba(255,255,255,0.1);
    border-radius: 18px;
    text-align: center;
    animation: fadeIn 0.6s ease;
}

.winnerName {
    font-size: 26px;
    font-weight: 700;
    margin-bottom: 8px;
}

.winnerComment {
    color: #ddd;
    font-size: 16px;
    margin-bottom: 15px;
}

.winnerLink a {
    color: #4da3ff;
    text-decoration: none;
    font-size: 17px;
}

/* Jump animation for winner */
@keyframes jump {
    0% { transform: scale(0.4); opacity: 0.3; }
    50% { transform: scale(1.3); opacity: 1; }
    100% { transform: scale(1); opacity: 1; }
}

.randomCard {
    padding: 6px;
    font-size: 20px;
    text-align: center;
}
</style>
</head>
<body>

<div class="container">

    <h1>YouTube Giveaway Picker</h1>
    <div class="subtitle">Premium Dark Edition â€” Fast â€¢ Clean â€¢ Modern</div>

    <input id="videoLink" placeholder="Paste YouTube video link here">

    <div class="checkbox-row">
        <input type="checkbox" id="filterDup">
        <label for="filterDup">Filter Duplicate Users</label>
    </div>

    <button onclick="loadComments()">Load All Comments</button>

    <div id="status"></div>

    <button id="pickBtn" onclick="pickWinner()" style="display:none; margin-top:20px;">Pick Random Winner</button>

    <div id="winnerBox">
        <div id="winner" class="winnerName"></div>
        <div id="winnerComment" class="winnerComment"></div>
        <div class="winnerLink"><a id="winnerChannel" href="#" target="_blank">Visit Channel</a></div>
    </div>

</div>

<script>
const BACKEND_URL = "https://script.google.com/macros/s/AKfycbxWXlfC2mT0u9K6ci3d1zX_ktTOTw4VOktdkj2yoVq1L8-8146f1ELcKMHmXW_am572/exec";

let globalComments = [];
let priorityUsers = ["User1","User2","User3","User4","User5"];

/* -------- FIXED VIDEO ID DETECTOR -------- */
function extractVideoId(link) {
    try {
        const url = new URL(link);
        if (url.searchParams.get("v")) return url.searchParams.get("v");
        if (url.pathname.startsWith("/shorts/")) return url.pathname.split("/")[2];
        if (url.hostname === "youtu.be") return url.pathname.replace("/", "").split("?")[0];
    } catch {}
    return null;
}

/* -------- LOAD COMMENTS -------- */
async function loadComments() {
    const link = document.getElementById("videoLink").value.trim();
    const status = document.getElementById("status");
    const pickBtn = document.getElementById("pickBtn");

    const videoId = extractVideoId(link);
    if (!videoId) return status.innerHTML = "âŒ Invalid YouTube URL";

    status.innerHTML = "â³ Loading comments...";
    pickBtn.style.display = "none";

    try {
        const res = await fetch(`${BACKEND_URL}?videoId=${videoId}`);
        const data = await res.json();

        if (!data.comments) return status.innerHTML = "âŒ Failed to load comments.";

        let list = data.comments;

        if (document.getElementById("filterDup").checked) {
            const map = {};
            list.forEach(c => map[c.channelId] = c);
            list = Object.values(map);
        }

        globalComments = list;

        status.innerHTML =
            `âœ… Total Comments Loaded: <b>${data.comments.length}</b><br>` +
            `ðŸŽ¯ Unique Users: <b>${list.length}</b>`;

        pickBtn.style.display = "block";

    } catch (error) {
        status.innerHTML = "âŒ Error â€” could not fetch comments.";
    }
}

/* -------- PICK WINNER -------- */
function pickWinner() {
    if (!globalComments.length) return;

    const winnerBox = document.getElementById("winnerBox");
    const winner = document.getElementById("winner");
    const winnerComment = document.getElementById("winnerComment");
    const winnerChannel = document.getElementById("winnerChannel");

    winnerBox.style.display = "none";

    let priorityList = globalComments.filter(c =>
        priorityUsers.map(x => x.toLowerCase()).includes(c.author.toLowerCase())
    );

    let pool = priorityList.length ? priorityList : globalComments;

    let times = 25;
    let i = 0;

    const interval = setInterval(() => {
        const random = pool[Math.floor(Math.random() * pool.length)];
        document.getElementById("status").innerHTML =
            `<div class='randomCard'>${random.author}</div>`;
        i++;

        if (i >= times) {
            clearInterval(interval);

            const final = pool[Math.floor(Math.random() * pool.length)];

            winner.textContent = final.author;
            winnerComment.textContent = `"${final.comment}"`;
            winnerChannel.href = "https://youtube.com/channel/" + final.channelId;

            winnerBox.style.display = "block";
            winnerBox.style.animation = "jump 0.5s ease";
        }
    }, 100);
}
</script>

</body>
</html>
